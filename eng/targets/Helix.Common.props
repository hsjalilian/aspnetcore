<Project>
  <!-- this file is shared between Helix.proj and .csproj files -->
  <PropertyGroup>
    <HelixQueueAlpine312>(Alpine.312.Amd64.Open)Ubuntu.1804.Amd64.Open@mcr.microsoft.com/dotnet-buildtools/prereqs:alpine-3.12-helix-20200908125345-56c6673</HelixQueueAlpine312>
    <HelixQueueDebian11>(Debian.11.Amd64.Open)Ubuntu.1804.Amd64.Open@mcr.microsoft.com/dotnet-buildtools/prereqs:debian-11-helix-amd64-20210304164428-5a7c380</HelixQueueDebian11>
    <HelixQueueFedora34>(Fedora.34.Amd64.Open)Ubuntu.1804.Amd64.Open@mcr.microsoft.com/dotnet-buildtools/prereqs:fedora-34-helix-20210728124700-4f64125</HelixQueueFedora34>
    <HelixQueueMariner>(Mariner)Ubuntu.1804.Amd64.Open@mcr.microsoft.com/dotnet-buildtools/prereqs:cbl-mariner-1.0-helix-20210528192219-92bf620</HelixQueueMariner>
    <HelixQueueArmDebian9>(Debian.9.Arm64.Open)Ubuntu.1804.Armarch.Open@mcr.microsoft.com/dotnet-buildtools/prereqs:debian-9-helix-arm64v8-a12566d-20190807161036</HelixQueueArmDebian9>
  </PropertyGroup>

  <Choose>
    <!-- Project selection can be overridden on the command line by passing in -projects. -->
    <When Condition=" '$(IsWindowsOnlyTest)' == 'true' ">
      <ItemGroup>
        <HelixAvailablePlatform Include="Windows" />
      </ItemGroup>
    </When>
    <Otherwise>
      <ItemGroup>
        <HelixAvailablePlatform Include="Linux" />
        <HelixAvailablePlatform Include="OSX" />
        <HelixAvailablePlatform Include="Windows" />
      </ItemGroup>
    </Otherwise>
  </Choose>

  <!--
    Usually do not need to check $(_UseHelixOpenQueues) or $(IsWindowsOnlyTest). Internal pipelines simply don't
    exist (most) or run (aspnetcore-helix-matrix-internal). (We can add another dimension to clauses below if
    necessary later.) Most Windows-specific checks are handled in above <Choose/> and Helix.props.
  -->
  <Choose>
    <When Condition=" '$(IsHelixDaily)' == 'true' ">
      <!-- aspnetcore-helix-matrix[-internal] (helix-matrix.yml) and RunHelix.ps1 -->
      <!-- aspnetcore-quarantined-tests (quarantined-tests.yml) and RunHelix.ps1 -RunQuarantinedTests -->
      <Choose>
        <When Condition=" '$(TargetArchitecture)' == 'x64' ">
          <ItemGroup>
            <!-- Linux -->
            <HelixAvailableTargetQueue Include="Redhat.7.Amd64.Open" Platform="Linux" />
            <HelixAvailableTargetQueue Include="Ubuntu.2004.Amd64.Open" Platform="Linux" />

            <!-- Containers -->
            <HelixAvailableTargetQueue Include="$(HelixQueueAlpine312)" Platform="Linux" />
            <HelixAvailableTargetQueue Include="$(HelixQueueDebian11)" Platform="Linux" />
            <HelixAvailableTargetQueue Include="$(HelixQueueFedora34)" Platform="Linux" />
            <HelixAvailableTargetQueue Include="$(HelixQueueMariner)" Platform="Linux" />

            <!-- Mac -->
            <HelixAvailableTargetQueue Include="OSX.1100.Amd64.Open" Platform="OSX" />

            <!-- Windows -->
            <HelixAvailableTargetQueue Include="Windows.10.Amd64.Server20H2.Open" Platform="Windows" />
            <HelixAvailableTargetQueue Include="Windows.11.Amd64.ClientPre.Open" Platform="Windows" />
            <HelixAvailableTargetQueue Include="Windows.Amd64.Server2022.Open" Platform="Windows" />
          </ItemGroup>
        </When>
        <Otherwise>
          <!-- '$(TargetArchitecture)' == 'arm64' -->
          <ItemGroup>
            <HelixAvailableTargetQueue Include="$(HelixQueueArmDebian9)" Platform="Linux" />
          </ItemGroup>

          <!-- IIS Express isn't supported on arm64 and most of the IsWindowsOnlyTests depend on its setup scripts. -->
          <ItemGroup Condition=" '$(IsWindowsOnlyTest)' != 'true' ">
            <HelixAvailableTargetQueue Include="Windows.10.Arm64v8.Open" Platform="Windows" />
          </ItemGroup>
        </Otherwise>
      </Choose>
    </When>
    <Otherwise>
      <!-- aspnetcore-ci[-official] (ci.yml) -->
      <!-- aspnetcore-quarantined-pr (quarantined-pr.yml) -->
      <ItemGroup>
        <HelixAvailableTargetQueue Include="Ubuntu.1804.Amd64.Open" Platform="Linux" />
        <HelixAvailableTargetQueue Include="OSX.1015.Amd64.Open" Platform="OSX" />
        <HelixAvailableTargetQueue Include="Windows.11.Amd64.ClientPre.Open" Platform="Windows" />
      </ItemGroup>
    </Otherwise>
  </Choose>
</Project>
